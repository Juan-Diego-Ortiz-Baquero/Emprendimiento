{% extends "layout.html" %}

{% block title %}Dashboard - {{ app_name }}{% endblock %}

{% block content %}
<!-- Alpine.js Data Component -->
<div x-data="dashboardApp()" x-init="init()" x-cloak>
    
    <!-- ========== SIDEBAR ========== -->
    <aside id="logo-sidebar" class="fixed top-0 left-0 z-40 w-64 h-screen transition-transform -translate-x-full sm:translate-x-0 sidebar-transition bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700" 
           :class="{'translate-x-0': sidebarOpen}">
        <div class="h-full px-3 pb-4 overflow-y-auto">
            <!-- Logo Section -->
            <div class="flex items-center justify-between py-5 px-2">
                <a href="/" class="flex items-center space-x-3">
                    <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-gradient-to-br from-primary-500 to-primary-700">
                        <i class="fas fa-cow text-white text-xl"></i>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-xl font-bold text-gray-900 dark:text-white">AgroTrace</span>
                        <span class="text-xs text-gray-500 dark:text-gray-400 font-mono">v3.0.0</span>
                    </div>
                </a>
            </div>
            
            <!-- Navigation Menu -->
            <ul class="space-y-2 font-medium mt-4">
                <!-- Dashboard -->
                <li>
                    <a href="#" @click.prevent="switchView('dashboard')" 
                       class="flex items-center p-2 text-gray-900 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 group"
                       :class="{'bg-primary-50 dark:bg-gray-700 text-primary-700 dark:text-primary-400': currentView === 'dashboard'}">
                        <i class="fas fa-th-large w-5 h-5 text-gray-500 group-hover:text-gray-900 dark:group-hover:text-white" 
                           :class="{'text-primary-600': currentView === 'dashboard'}"></i>
                        <span class="ml-3">Dashboard</span>
                    </a>
                </li>
                
                <!-- Animals -->
                <li>
                    <a href="#" @click.prevent="switchView('animals')" 
                       class="flex items-center p-2 text-gray-900 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 group"
                       :class="{'bg-primary-50 dark:bg-gray-700 text-primary-700 dark:text-primary-400': currentView === 'animals'}">
                        <i class="fas fa-cow w-5 h-5 text-gray-500 group-hover:text-gray-900 dark:group-hover:text-white"
                           :class="{'text-primary-600': currentView === 'animals'}"></i>
                        <span class="flex-1 ml-3 whitespace-nowrap">Animales</span>
                        <span class="inline-flex items-center justify-center px-2 ml-3 text-sm font-medium text-gray-800 bg-gray-100 rounded-full dark:bg-gray-700 dark:text-gray-300">155</span>
                    </a>
                </li>
                
                <!-- Health -->
                <li>
                    <a href="#" @click.prevent="switchView('health')" 
                       class="flex items-center p-2 text-gray-900 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 group"
                       :class="{'bg-primary-50 dark:bg-gray-700 text-primary-700 dark:text-primary-400': currentView === 'health'}">
                        <i class="fas fa-heartbeat w-5 h-5 text-gray-500 group-hover:text-gray-900 dark:group-hover:text-white"
                           :class="{'text-primary-600': currentView === 'health'}"></i>
                        <span class="flex-1 ml-3 whitespace-nowrap">Salud</span>
                        <span class="inline-flex items-center justify-center w-3 h-3 p-3 ml-3 text-sm font-medium text-red-800 bg-red-100 rounded-full dark:bg-red-900 dark:text-red-300" x-show="stats.critical > 0" x-text="stats.critical"></span>
                    </a>
                </li>
                
                <!-- Reports -->
                <li>
                    <a href="#" @click.prevent="switchView('reports')" 
                       class="flex items-center p-2 text-gray-900 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 group"
                       :class="{'bg-primary-50 dark:bg-gray-700 text-primary-700 dark:text-primary-400': currentView === 'reports'}">
                        <i class="fas fa-chart-line w-5 h-5 text-gray-500 group-hover:text-gray-900 dark:group-hover:text-white"
                           :class="{'text-primary-600': currentView === 'reports'}"></i>
                        <span class="ml-3">Reportes</span>
                    </a>
                </li>
                
                <!-- Settings -->
                <li>
                    <a href="#" @click.prevent="switchView('settings')" 
                       class="flex items-center p-2 text-gray-900 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 group"
                       :class="{'bg-primary-50 dark:bg-gray-700 text-primary-700 dark:text-primary-400': currentView === 'settings'}">
                        <i class="fas fa-cog w-5 h-5 text-gray-500 group-hover:text-gray-900 dark:group-hover:text-white"
                           :class="{'text-primary-600': currentView === 'settings'}"></i>
                        <span class="ml-3">Configuración</span>
                    </a>
                </li>
            </ul>
            
            <!-- User Profile Section -->
            <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200 dark:border-gray-700">
                <div class="flex items-center">
                    <img class="w-10 h-10 rounded-full" src="https://ui-avatars.com/api/?name=Admin&background=22c55e&color=fff" alt="User">
                    <div class="ml-3">
                        <p class="text-sm font-medium text-gray-900 dark:text-white">Admin</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Administrador</p>
                    </div>
                </div>
            </div>
        </div>
    </aside>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <span class="nav-section-title">Principal</span>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="#" class="nav-link active" data-view="dashboard">
                                <i class="fas fa-th-large"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-view="animals">
                                <i class="fas fa-cow"></i>
                                <span>Animales</span>
                                <span class="nav-badge">155</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-view="health">
                                <i class="fas fa-heartbeat"></i>
                                <span>Salud</span>
                                <span class="nav-badge warning">7</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <span class="nav-section-title">Operaciones</span>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-view="traceability">
                                <i class="fas fa-route"></i>
                                <span>Trazabilidad</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-view="reports">
                                <i class="fas fa-chart-line"></i>
                                <span>Reportes</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-view="activity">
                                <i class="fas fa-history"></i>
                                <span>Actividad</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <span class="nav-section-title">Sistema</span>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-view="settings">
                                <i class="fas fa-cog"></i>
                                <span>Configuración</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="user-avatar">
                        <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=40&h=40&fit=crop&crop=face" alt="Usuario">
                        <div class="user-status online"></div>
                    </div>
                    <div class="user-info">
                        <span class="user-name">Juan Pérez</span>
                        <span class="user-role">Administrador</span>
                    </div>
                    <button class="user-menu-btn">
                        <i class="fas fa-ellipsis-h"></i>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <header class="top-bar">
                <div class="top-bar-left">
                    <h1 class="page-title" id="page-title">Dashboard</h1>
                    <div class="system-status">
                        <div class="status-indicator">
                            <div class="status-dot online"></div>
                            <span>Sistema operativo</span>
                        </div>
                        <div class="last-sync">
                            <i class="fas fa-sync-alt rotating"></i>
                            <span id="sync-time">Sincronizado hace 2s</span>
                        </div>
                    </div>
                </div>
                
                <div class="top-bar-right">
                    <div class="search-container">
                        <input type="text" class="global-search" placeholder="Buscar animales, IDs, alertas...">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                    
                    <div class="top-bar-actions">
                        <button class="action-btn" title="Notificaciones">
                            <i class="fas fa-bell"></i>
                            <span class="notification-count">3</span>
                        </button>
                        <button class="action-btn" id="theme-toggle" title="Cambiar tema">
                            <i class="fas fa-moon"></i>
                        </button>
                        <button class="action-btn" title="Ayuda">
                            <i class="fas fa-question-circle"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Content Views -->
            <div class="content-container">
                <!-- Dashboard View -->
                <div id="dashboard-view" class="content-view active">                    <!-- Stats Overview -->
                    <div class="stats-grid">
                        <div class="stat-card primary" data-stat="total-animals">
                            <div class="stat-header">
                                <div class="stat-icon primary">
                                    <i class="fas fa-cow"></i>
                                </div>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="total-animals">156</div>
                                <div class="stat-label">Total Animales</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i>
                                    +12 esta semana
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card success" data-stat="healthy-animals">
                            <div class="stat-header">
                                <div class="stat-icon success">
                                    <i class="fas fa-heart-pulse"></i>
                                </div>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="healthy-animals">142</div>
                                <div class="stat-label">Animales Saludables</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i>
                                    +5 esta semana
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card warning" data-stat="alerts">
                            <div class="stat-header">
                                <div class="stat-icon warning">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="alerts">3</div>
                                <div class="stat-label">Alertas Activas</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-arrow-down"></i>
                                    -2 hoy
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card secondary" data-stat="locations">
                            <div class="stat-header">
                                <div class="stat-icon secondary">
                                    <i class="fas fa-map-marker-alt"></i>
                                </div>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="locations">8</div>
                                <div class="stat-label">Ubicaciones Activas</div>
                                <div class="stat-change neutral">
                                    <i class="fas fa-minus"></i>
                                    Sin cambios
                                </div>
                            </div>
                        </div>
                    </div>                    <!-- Charts and Activity -->
                    <div class="content-grid">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Actividad RFID - Últimos 7 días</h3>
                                <div class="chart-controls">
                                    <select class="filter-select">
                                        <option>Últimos 7 días</option>
                                        <option>Último mes</option>
                                        <option>Últimos 3 meses</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-canvas">
                                <canvas id="activity-chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="activity-feed">
                            <div class="activity-header">
                                <h3 class="activity-title">Actividad Reciente</h3>
                                <button class="btn-link" onclick="loadDashboardData()">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                            <ul class="activity-list">
                                <!-- Activities will be loaded here -->
                            </ul>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <div class="quick-actions-header">
                            <h3 class="quick-actions-title">Acciones Rápidas</h3>
                        </div>
                        <div class="actions-grid">
                            <button class="action-btn" onclick="handleQuickAction('nuevo-animal')">
                                <i class="fas fa-plus-circle"></i>
                                <span>Nuevo Animal</span>
                            </button>
                            <button class="action-btn" onclick="handleQuickAction('escanear-rfid')">
                                <i class="fas fa-wifi"></i>
                                <span>Escanear RFID</span>
                            </button>
                            <button class="action-btn" onclick="handleQuickAction('registro-salud')">
                                <i class="fas fa-heart-pulse"></i>
                                <span>Registro Salud</span>
                            </button>
                            <button class="action-btn" onclick="handleQuickAction('generar-reporte')">
                                <i class="fas fa-file-alt"></i>
                                <span>Generar Reporte</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Animals View -->
                <div id="animals-view" class="content-view">
                    <div class="view-header">
                        <h2>Gestión de Animales</h2>
                        <div class="view-actions">
                            <div class="search-box">
                                <input type="text" placeholder="Buscar por ID, nombre o raza..." id="animals-search">
                                <i class="fas fa-search"></i>
                            </div>
                            <button class="btn btn-primary">
                                <i class="fas fa-plus"></i>
                                Nuevo animal
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-card">
                        <div class="table-controls">
                            <div class="table-filters">
                                <select class="filter-select">
                                    <option>Todos los estados</option>
                                    <option>Saludable</option>
                                    <option>En tratamiento</option>
                                    <option>Cuarentena</option>
                                </select>
                                <select class="filter-select">
                                    <option>Todas las razas</option>
                                    <option>Holstein</option>
                                    <option>Brahman</option>
                                    <option>Angus</option>
                                </select>
                            </div>
                            <div class="table-view-options">
                                <button class="view-btn active" data-view="table">
                                    <i class="fas fa-table"></i>
                                </button>
                                <button class="view-btn" data-view="grid">
                                    <i class="fas fa-th"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table class="data-table" id="animals-table">
                                <thead>
                                    <tr>
                                        <th>
                                            <input type="checkbox" class="select-all">
                                        </th>
                                        <th>ID RFID</th>
                                        <th>Nombre</th>
                                        <th>Raza</th>
                                        <th>Edad</th>
                                        <th>Estado</th>
                                        <th>Último escaneo</th>
                                        <th>Ubicación</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="animals-tbody">
                                    <!-- Datos cargados dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="table-pagination">
                            <div class="pagination-info">
                                Mostrando <span id="showing-start">1</span>-<span id="showing-end">15</span> de <span id="total-records">155</span> registros
                            </div>
                            <div class="pagination-controls">
                                <button class="page-btn" disabled>
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <span class="page-numbers">
                                    <button class="page-btn active">1</button>
                                    <button class="page-btn">2</button>
                                    <button class="page-btn">3</button>
                                </span>
                                <button class="page-btn">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Health View -->
                <div id="health-view" class="content-view">
                    <div class="view-header">
                        <h2>Monitoreo de Salud</h2>
                    </div>
                    
                    <div class="health-overview">
                        <div class="health-stats">
                            <div class="health-stat">
                                <div class="health-icon success">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                <div class="health-info">
                                    <h4 id="vaccination-rate">94.2%</h4>
                                    <p>Tasa vacunación</p>
                                </div>
                            </div>
                            
                            <div class="health-stat">
                                <div class="health-icon warning">
                                    <i class="fas fa-pills"></i>
                                </div>
                                <div class="health-info">
                                    <h4 id="active-treatments">12</h4>
                                    <p>Tratamientos activos</p>
                                </div>
                            </div>
                            
                            <div class="health-stat">
                                <div class="health-icon danger">
                                    <i class="fas fa-ban"></i>
                                </div>
                                <div class="health-info">
                                    <h4 id="quarantined">3</h4>
                                    <p>En cuarentena</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other views placeholders -->
                <div id="traceability-view" class="content-view">
                    <div class="view-header">
                        <h2>Cadena de Trazabilidad</h2>
                    </div>
                    <div class="coming-soon">
                        <i class="fas fa-route"></i>
                        <p>Módulo en desarrollo</p>
                    </div>
                </div>

                <div id="reports-view" class="content-view">
                    <div class="view-header">
                        <h2>Reportes y Análisis</h2>
                    </div>
                    <div class="coming-soon">
                        <i class="fas fa-chart-line"></i>
                        <p>Módulo en desarrollo</p>
                    </div>
                </div>

                <div id="activity-view" class="content-view">
                    <div class="view-header">
                        <h2>Log de Actividad</h2>
                    </div>
                    <div class="coming-soon">
                        <i class="fas fa-history"></i>
                        <p>Módulo en desarrollo</p>
                    </div>
                </div>

                <div id="settings-view" class="content-view">
                    <div class="view-header">
                        <h2>Configuración del Sistema</h2>
                    </div>
                    <div class="coming-soon">
                        <i class="fas fa-cog"></i>
                        <p>Módulo en desarrollo</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="app-footer">
        <div class="footer-content">
            <span>AgroTrace System v2.1.4 • Build 2025.11.05</span>
            <span>•</span>
            <span>Desarrollado por Santiago Valenzuela & Juan Ortiz</span>
            <span>•</span>
            <span>Facultad de Ingeniería de Sistemas</span>
            <span class="system-time" id="system-time"></span>
        </div>
    </footer>

    <!-- Notification Toast -->
    <div id="notification-toast" class="notification-toast">
        <div class="toast-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="toast-content">
            <span class="toast-title">Notificación</span>
            <span class="toast-message">Mensaje del sistema</span>
        </div>
        <button class="toast-close">
            <i class="fas fa-times"></i>
        </button>
    </div>    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
